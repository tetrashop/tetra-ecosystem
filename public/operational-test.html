<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Tetra Ecosystem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body class="bg-dark text-light">
    <div class="container py-5">
        <div class="text-center mb-5">
            <h1 class="text-success">
                <i class="bi bi-check-circle-fill"></i>
                ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Tetra Ecosystem
            </h1>
            <p class="lead">Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù‡Ù…Ù‡ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§</p>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h4>âœ… Ø³ÛŒØ³ØªÙ… ÙØ¹Ø§Ù„ Ø§Ø³Øª!</h4>
                        <p>Ù‡Ù…Ù‡ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª Ù‡Ø³ØªÙ†Ø¯</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- ØªØ³Øª Û±: Ø³ÛŒØ³ØªÙ… Ø¯Ø§Ø¯Ù‡ -->
            <div class="col-md-6 mb-3">
                <div class="card bg-secondary">
                    <div class="card-body">
                        <h5>ğŸ—ƒï¸ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø¯Ø§Ø¯Ù‡</h5>
                        <button class="btn btn-outline-light w-100 mb-2" onclick="testDataSystem()">
                            ØªØ³Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
                        </button>
                        <div id="dataTestResult"></div>
                    </div>
                </div>
            </div>

            <!-- ØªØ³Øª Û²: Ù…Ø§Ù„ÛŒ -->
            <div class="col-md-6 mb-3">
                <div class="card bg-secondary">
                    <div class="card-body">
                        <h5>ğŸ’° ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù„ÛŒ</h5>
                        <button class="btn btn-outline-success w-100 mb-2" onclick="testFinancialSystem()">
                            ØªØ³Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
                        </button>
                        <div id="financeTestResult"></div>
                    </div>
                </div>
            </div>

            <!-- ØªØ³Øª Û³: Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
            <div class="col-md-6 mb-3">
                <div class="card bg-secondary">
                    <div class="card-body">
                        <h5>ğŸ‘¥ ØªØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h5>
                        <button class="btn btn-outline-info w-100 mb-2" onclick="testUserSystem()">
                            ØªØ³Øª Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                        </button>
                        <div id="userTestResult"></div>
                    </div>
                </div>
            </div>

            <!-- ØªØ³Øª Û´: Ù…Ø­Ø±ÙˆÙ…ÛŒÙ† -->
            <div class="col-md-6 mb-3">
                <div class="card bg-secondary">
                    <div class="card-body">
                        <h5>ğŸ¤ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ù…Ø­Ø±ÙˆÙ…ÛŒÙ†</h5>
                        <button class="btn btn-outline-warning w-100 mb-2" onclick="testSocialSystem()">
                            ØªØ³Øª Ú©Ù…Ú©â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¯Ù…ÛŒ
                        </button>
                        <div id="socialTestResult"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù†ØªØ§ÛŒØ¬ Ú©Ù„ÛŒ -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card bg-dark">
                    <div class="card-body">
                        <h5 class="text-center">ğŸ“Š Ù†ØªØ§ÛŒØ¬ ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§ØªÛŒ</h5>
                        <div id="overallResults"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø³Ø±ÛŒØ¹ -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card bg-secondary">
                    <div class="card-body text-center">
                        <h5>ğŸš€ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§</h5>
                        <div class="btn-group">
                            <a href="admin-real-data.html" class="btn btn-success">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</a>
                            <a href="system-status.html" class="btn btn-info">ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</a>
                            <a href="social-care.html" class="btn btn-warning">Ø³ÛŒØ³ØªÙ… Ù…Ø­Ø±ÙˆÙ…ÛŒÙ†</a>
                            <a href="donation-system.html" class="btn btn-primary">Ú©Ù…Ú© Ù…Ø§Ù„ÛŒ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data-manager.js"></script>
    <script>
        const testResults = {
            data: false,
            financial: false,
            users: false,
            social: false
        };

        function testDataSystem() {
            const resultDiv = document.getElementById('dataTestResult');
            resultDiv.innerHTML = '<div class="text-warning">ğŸ” Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡...</div>';

            try {
                if (!window.tetraData) {
                    throw new Error('Ø³ÛŒØ³ØªÙ… Ø¯Ø§Ø¯Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡');
                }

                // ØªØ³Øª Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² Ù‡Ù…Ù‡ Ø¬Ø¯Ø§ÙˆÙ„
                const tables = ['users', 'transactions', 'conversions', 'socialProjects', 'donations'];
                let allTablesOk = true;

                tables.forEach(table => {
                    try {
                        const data = tetraData.getAll(table);
                        console.log(`âœ… ${table}: ${data.length} Ø±Ú©ÙˆØ±Ø¯`);
                    } catch (error) {
                        console.error(`âŒ ${table}: ${error.message}`);
                        allTablesOk = false;
                    }
                });

                if (allTablesOk) {
                    testResults.data = true;
                    resultDiv.innerHTML = `
                        <div class="text-success">
                            âœ… Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø³Ø§Ù„Ù… Ø§Ø³Øª
                            <br>
                            <small class="text-muted">Ù‡Ù…Ù‡ Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ù‡Ø³ØªÙ†Ø¯</small>
                        </div>
                    `;
                } else {
                    throw new Error('Ø¨Ø±Ø®ÛŒ Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ù†Ø¯');
                }

            } catch (error) {
                testResults.data = false;
                resultDiv.innerHTML = `
                    <div class="text-danger">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
                        <br>
                        <small class="text-muted">${error.message}</small>
                    </div>
                `;
            }

            updateOverallResults();
        }

        function testFinancialSystem() {
            const resultDiv = document.getElementById('financeTestResult');
            resultDiv.innerHTML = '<div class="text-warning">ğŸ’³ Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù„ÛŒ...</div>';

            try {
                const stats = tetraData.getFinancialStats();
                
                // Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ ØªØ³Øª
                const testTransaction = tetraData.create('transactions', {
                    userId: 1,
                    type: 'test',
                    amount: 50000,
                    description: 'ØªØ±Ø§Ú©Ù†Ø´ ØªØ³Øª Ø³ÛŒØ³ØªÙ…',
                    status: 'completed'
                });

                testResults.financial = true;
                resultDiv.innerHTML = `
                    <div class="text-success">
                        âœ… Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù„ÛŒ ÙØ¹Ø§Ù„ Ø§Ø³Øª
                        <br>
                        <small class="text-muted">
                            Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„: ${stats.totalRevenue.toLocaleString()} ØªÙˆÙ…Ø§Ù†
                            <br>
                            ØªØ±Ø§Ú©Ù†Ø´ ØªØ³Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯
                        </small>
                    </div>
                `;

            } catch (error) {
                testResults.financial = false;
                resultDiv.innerHTML = `
                    <div class="text-danger">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù„ÛŒ
                        <br>
                        <small class="text-muted">${error.message}</small>
                    </div>
                `;
            }

            updateOverallResults();
        }

        function testUserSystem() {
            const resultDiv = document.getElementById('userTestResult');
            resultDiv.innerHTML = '<div class="text-warning">ğŸ‘¤ Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ú©Ø§Ø±Ø¨Ø±Ø§Ù†...</div>';

            try {
                const userStats = tetraData.getUserStats();
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª
                const testUser = tetraData.create('users', {
                    name: 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª',
                    email: 'test@tetra.ir',
                    role: 'user',
                    balance: 100000,
                    joined: new Date().toLocaleString('fa-IR')
                });

                testResults.users = true;
                resultDiv.innerHTML = `
                    <div class="text-success">
                        âœ… Ø³ÛŒØ³ØªÙ… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„ Ø§Ø³Øª
                        <br>
                        <small class="text-muted">
                            ${userStats.totalUsers} Ú©Ø§Ø±Ø¨Ø±
                            <br>
                            Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯
                        </small>
                    </div>
                `;

            } catch (error) {
                testResults.users = false;
                resultDiv.innerHTML = `
                    <div class="text-danger">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                        <br>
                        <small class="text-muted">${error.message}</small>
                    </div>
                `;
            }

            updateOverallResults();
        }

        function testSocialSystem() {
            const resultDiv = document.getElementById('socialTestResult');
            resultDiv.innerHTML = '<div class="text-warning">ğŸ¤ Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ù…Ø­Ø±ÙˆÙ…ÛŒÙ†...</div>';

            try {
                const socialStats = tetraData.getSocialStats();
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù…Ú© ØªØ³Øª
                const testDonation = tetraData.create('donations', {
                    amount: 250000,
                    projectId: 1,
                    donorName: 'Ø­Ø§Ù…ÛŒ ØªØ³Øª',
                    method: 'bank',
                    date: new Date().toLocaleString('fa-IR')
                });

                testResults.social = true;
                resultDiv.innerHTML = `
                    <div class="text-success">
                        âœ… Ø³ÛŒØ³ØªÙ… Ù…Ø­Ø±ÙˆÙ…ÛŒÙ† ÙØ¹Ø§Ù„ Ø§Ø³Øª
                        <br>
                        <small class="text-muted">
                            ${socialStats.totalDonations.toLocaleString()} ØªÙˆÙ…Ø§Ù† Ú©Ù…Ú©
                            <br>
                            Ú©Ù…Ú© ØªØ³Øª Ø«Ø¨Øª Ø´Ø¯
                        </small>
                    </div>
                `;

            } catch (error) {
                testResults.social = false;
                resultDiv.innerHTML = `
                    <div class="text-danger">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ù…Ø­Ø±ÙˆÙ…ÛŒÙ†
                        <br>
                        <small class="text-muted">${error.message}</small>
                    </div>
                `;
            }

            updateOverallResults();
        }

        function updateOverallResults() {
            const resultsDiv = document.getElementById('overallResults');
            const passedTests = Object.values(testResults).filter(result => result).length;
            const totalTests = Object.values(testResults).length;

            let html = `
                <div class="progress mb-3" style="height: 30px;">
                    <div class="progress-bar ${passedTests === totalTests ? 'bg-success' : 'bg-warning'}" 
                         style="width: ${(passedTests / totalTests) * 100}%">
                        ${passedTests} Ø§Ø² ${totalTests}
                    </div>
                </div>
                <div class="row text-center">
            `;

            Object.entries(testResults).forEach(([test, passed]) => {
                const testNames = {
                    data: 'Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡',
                    financial: 'Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù„ÛŒ', 
                    users: 'Ú©Ø§Ø±Ø¨Ø±Ø§Ù†',
                    social: 'Ù…Ø­Ø±ÙˆÙ…ÛŒÙ†'
                };

                html += `
                    <div class="col-3">
                        <div class="${passed ? 'text-success' : 'text-danger'}">
                            ${passed ? 'âœ…' : 'âŒ'}
                        </div>
                        <small>${testNames[test]}</small>
                    </div>
                `;
            });

            html += '</div>';

            if (passedTests === totalTests) {
                html += `
                    <div class="alert alert-success mt-3 text-center">
                        <h5>ğŸ‰ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù†Ø¯!</h5>
                        <p class="mb-0">Ø³ÛŒØ³ØªÙ… Tetra Ecosystem Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø§Ø³Øª</p>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
        }

        // ØªØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Tetra Ecosystem - Operational Test Ready');
            setTimeout(testDataSystem, 1000);
        });
    </script>
</body>
</html>
