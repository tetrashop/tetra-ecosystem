<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØªØ±Ø§ 3D - Ø³ÛŒØ³ØªÙ… ØªØ¨Ø¯ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ ØªØµØ§ÙˆÛŒØ±</title>
    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --dark: #1a1a2e;
            --darker: #16213e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Tahoma, sans-serif;
            direction: rtl;
            background: linear-gradient(135deg, var(--dark), var(--darker));
            color: white;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; padding: 2rem 0; }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .plan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 2rem 0;
        }
        .plan {
            background: white;
            color: #333;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .plan:hover { transform: translateY(-5px); }
        .plan.recommended { border: 3px solid var(--success); position: relative; }
        .plan.recommended::before {
            content: "Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡";
            background: var(--success);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .upload-area {
            border: 3px dashed var(--primary);
            padding: 3rem;
            text-align: center;
            border-radius: 10px;
            background: rgba(0,123,255,0.1);
            margin: 2rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover { background: rgba(0,123,255,0.2); }
        .upload-area.dragover { background: rgba(40,167,69,0.2); border-color: var(--success); }
        .progress-bar {
            background: #ddd;
            height: 20px;
            border-radius: 10px;
            margin: 1rem 0;
            overflow: hidden;
        }
        .progress {
            background: linear-gradient(45deg, var(--primary), var(--success));
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .payment-info {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }
        .bank-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }
        .feature-list { list-style: none; padding: 0; }
        .feature-list li { padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .feature-list li:before { content: "âœ… "; margin-left: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ù‡Ø¯Ø± -->
        <div class="header">
            <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">ğŸ¯ ØªØªØ±Ø§ 3D - Ø³ÛŒØ³ØªÙ… ØªØ¨Ø¯ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">ØªØ¨Ø¯ÛŒÙ„ ØªØµØ§ÙˆÛŒØ± 2D Ø¨Ù‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ 3D Ø¨Ø§ Ú©ÛŒÙÛŒØª studio</p>
        </div>

        <!-- Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ Ù¾Ù„Ù†â€ŒÙ‡Ø§ -->
        <div class="card">
            <h2 style="text-align: center; margin-bottom: 2rem;">ğŸ’° Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù† Ù…Ù†Ø§Ø³Ø¨</h2>
            <div class="plan-grid">
                <!-- Ù¾Ù„Ù† Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ -->
                <div class="plan">
                    <h3>ğŸ†“ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ</h3>
                    <div style="font-size: 2rem; color: var(--success); margin: 1rem 0;">Ø±Ø§ÛŒÚ¯Ø§Ù†</div>
                    <ul class="feature-list">
                        <li>Û± ØªØ¨Ø¯ÛŒÙ„ Ø±Ø§ÛŒÚ¯Ø§Ù†</li>
                        <li>Ú©ÛŒÙÛŒØª Ù¾Ø§ÛŒÙ‡</li>
                        <li>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§ÛŒÙ…ÛŒÙ„</li>
                        <li>Ù…Ø¯Øª ØªØ³Øª: Û· Ø±ÙˆØ²</li>
                    </ul>
                    <button class="btn btn-success" onclick="selectPlan('free')" style="width: 100%; margin-top: 1rem;">
                        ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†
                    </button>
                </div>

                <!-- Ù¾Ù„Ù† Ù¾Ø§ÛŒÙ‡ -->
                <div class="plan recommended">
                    <h3>â­ Ù¾Ø§ÛŒÙ‡</h3>
                    <div style="font-size: 2rem; color: var(--primary); margin: 1rem 0;">ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                    <ul class="feature-list">
                        <li>Û±Û° ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§</li>
                        <li>Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø± ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù</li>
                        <li>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ„ÙÙ†ÛŒ</li>
                        <li>ÙØ¶Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ÛµGB</li>
                    </ul>
                    <button class="btn btn-primary" onclick="selectPlan('basic')" style="width: 100%; margin-top: 1rem;">
                        Ø®Ø±ÛŒØ¯ Ù¾Ù„Ù† Ù¾Ø§ÛŒÙ‡
                    </button>
                </div>

                <!-- Ù¾Ù„Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ -->
                <div class="plan">
                    <h3>ğŸ† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</h3>
                    <div style="font-size: 2rem; color: var(--danger); margin: 1rem 0;">Û±ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                    <ul class="feature-list">
                        <li>ØªØ¨Ø¯ÛŒÙ„ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯</li>
                        <li>Ú©ÛŒÙÛŒØª studio</li>
                        <li>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ VIP</li>
                        <li>ÙØ¶Ø§ÛŒ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯</li>
                        <li>Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ</li>
                    </ul>
                    <button class="btn btn-danger" onclick="selectPlan('pro')" style="width: 100%; margin-top: 1rem;">
                        Ø®Ø±ÛŒØ¯ Ù¾Ù„Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
                    </button>
                </div>
            </div>

            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª -->
            <div class="payment-info">
                <h3>ğŸ’³ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
                <div class="bank-card">
                    <h4>Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; letter-spacing: 2px; margin: 1rem 0;">
                        Û¶Û²Û±Û¹ - Û¸Û¶Û±Û¸ - Û´Û·Û´Û´ - Û¹Û±Û±Û²
                    </div>
                    <p>Ø¨Ù‡ Ù†Ø§Ù…: ØªØªØ±Ø§ Ø´Ø§Ù¾</p>
                </div>
                <p style="margin-top: 1rem;">
                    ğŸ“ Ù¾Ø³ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®ØªØŒ ØªØµÙˆÛŒØ± Ø±Ø³ÛŒØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ù„Ù† Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø´ÙˆØ¯<br>
                    âœ‰ï¸ Ø¢ÛŒØ¯ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…: @tetrashop_support
                </p>
            </div>
        </div>

        <!-- Ø³ÛŒØ³ØªÙ… ØªØ¨Ø¯ÛŒÙ„ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„) -->
        <div id="converter-section" class="card" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 2rem;">ğŸ¨ ØªØ¨Ø¯ÛŒÙ„ ØªØµÙˆÛŒØ± Ø¨Ù‡ Ù…Ø¯Ù„ 3D</h2>
            
            <!-- Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø± -->
            <div id="user-stats" class="stats-grid">
                <div class="stat-item">
                    <div>Ù¾Ù„Ù† ÙØ¹Ù„ÛŒ</div>
                    <div id="current-plan" style="font-size: 1.2rem; font-weight: bold;">-</div>
                </div>
                <div class="stat-item">
                    <div>ØªØ¨Ø¯ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</div>
                    <div id="remaining-conversions" style="font-size: 1.2rem; font-weight: bold;">0</div>
                </div>
                <div class="stat-item">
                    <div>Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡</div>
                    <div id="used-conversions" style="font-size: 1.2rem; font-weight: bold;">0</div>
                </div>
                <div class="stat-item">
                    <div>Ø§Ø¹ØªØ¨Ø§Ø± ØªØ§</div>
                    <div id="expiry-date" style="font-size: 1.2rem; font-weight: bold;">-</div>
                </div>
            </div>

            <!-- Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± -->
            <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“</div>
                <h3>ØªØµÙˆÛŒØ± Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</h3>
                <p>ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ: JPG, PNG, WebP, BMP</p>
                <p style="color: #ff6b6b; margin-top: 1rem;">Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù…: Û²Û° Ù…Ú¯Ø§Ø¨Ø§ÛŒØª</p>
            </div>
            <input type="file" id="file-input" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">

            <!-- Ù¾Ø±Ø¯Ø§Ø²Ø´ -->
            <div id="processing-section" style="display: none;">
                <h3 style="text-align: center; margin: 2rem 0;">â³ Ø¯Ø± Ø­Ø§Ù„ ØªØ¨Ø¯ÛŒÙ„ ØªØµÙˆÛŒØ± Ø¨Ù‡ Ù…Ø¯Ù„ 3D...</h3>
                <div class="progress-bar">
                    <div class="progress" id="conversion-progress"></div>
                </div>
                <p style="text-align: center;" id="progress-text">0%</p>
                
                <div id="processing-details" style="margin-top: 2rem;">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div>ØªØ´Ø®ÛŒØµ Ù„Ø¨Ù‡â€ŒÙ‡Ø§</div>
                            <div id="edge-detection">â³</div>
                        </div>
                        <div class="stat-item">
                            <div>Ø§ÛŒØ¬Ø§Ø¯ Ø¹Ù…Ù‚</div>
                            <div id="depth-generation">â³</div>
                        </div>
                        <div class="stat-item">
                            <div>Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¨Ú©Ù‡</div>
                            <div id="mesh-optimization">â³</div>
                        </div>
                        <div class="stat-item">
                            <div>ØªÚ©Ø³Ú†Ø±ÛŒÙ†Ú¯</div>
                            <div id="texturing">â³</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù†ØªØ§ÛŒØ¬ -->
            <div id="result-section" class="card" style="display: none; background: rgba(40,167,69,0.1);">
                <h3 style="text-align: center; color: var(--success);">âœ… ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!</h3>
                
                <div class="stats-grid" style="margin: 2rem 0;">
                    <div class="stat-item">
                        <div>ØªØ¹Ø¯Ø§Ø¯ ÙˆØ±ØªÚ©Ø³</div>
                        <div id="vertex-count" style="font-size: 1.2rem; font-weight: bold;">0</div>
                    </div>
                    <div class="stat-item">
                        <div>ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª</div>
                        <div id="face-count" style="font-size: 1.2rem; font-weight: bold;">0</div>
                    </div>
                    <div class="stat-item">
                        <div>Ø§Ø¨Ø¹Ø§Ø¯ Ù…Ø¯Ù„</div>
                        <div id="model-dimensions" style="font-size: 1.2rem; font-weight: bold;">0Ã—0Ã—0</div>
                    </div>
                    <div class="stat-item">
                        <div>Ø­Ø¬Ù… ÙØ§ÛŒÙ„</div>
                        <div id="file-size" style="font-size: 1.2rem; font-weight: bold;">0 MB</div>
                    </div>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <h4>ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¯Ù„ 3D</h4>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin: 1rem 0;">
                        <button class="btn btn-success" onclick="downloadModel('glb')">GLB Format</button>
                        <button class="btn btn-primary" onclick="downloadModel('obj')">OBJ Format</button>
                        <button class="btn btn-primary" onclick="downloadModel('stl')">STL Format</button>
                        <button class="btn btn-primary" onclick="downloadModel('fbx')">FBX Format</button>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" onclick="resetConverter()" style="background: #6c757d; color: white;">
                        ğŸ”„ ØªØ¨Ø¯ÛŒÙ„ ØªØµÙˆÛŒØ± Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>
            </div>
        </div>

        <!-- Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª -->
        <div id="admin-section" class="card" style="display: none;">
            <h3>ğŸ“Š Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div>Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</div>
                    <div id="total-users">0</div>
                </div>
                <div class="stat-item">
                    <div>ØªØ¨Ø¯ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</div>
                    <div id="today-conversions">0</div>
                </div>
                <div class="stat-item">
                    <div>Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ù…Ø±ÙˆØ²</div>
                    <div id="today-revenue">0 ØªÙˆÙ…Ø§Ù†</div>
                </div>
                <div class="stat-item">
                    <div>Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„</div>
                    <div id="total-revenue">0 ØªÙˆÙ…Ø§Ù†</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
        class TetraUserManager {
            constructor() {
                this.users = new Map();
                this.currentUser = null;
                this.loadUsers();
            }

            createUser(userId, plan = 'free', paymentData = null) {
                const userData = {
                    id: userId,
                    plan: plan,
                    conversionsUsed: 0,
                    joinDate: new Date().toISOString(),
                    expiryDate: this.calculateExpiryDate(plan),
                    paymentData: paymentData,
                    conversions: []
                };
                
                this.users.set(userId, userData);
                this.currentUser = userId;
                this.saveUsers();
                return userData;
            }

            calculateExpiryDate(plan) {
                const date = new Date();
                if (plan === 'free') date.setDate(date.getDate() + 7);
                else if (plan === 'basic') date.setMonth(date.getMonth() + 1);
                else if (plan === 'pro') date.setFullYear(date.getFullYear() + 1);
                return date.toISOString();
            }

            canConvert(userId) {
                const user = this.users.get(userId);
                if (!user) return false;

                // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ù‚Ø¶Ø§
                if (new Date() > new Date(user.expiryDate)) {
                    return false;
                }

                // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù¾Ù„Ù†
                const limit = this.getPlanLimit(user.plan);
                return user.conversionsUsed < limit;
            }

            recordConversion(userId, imageInfo, modelInfo) {
                const user = this.users.get(userId);
                if (user) {
                    user.conversionsUsed++;
                    user.conversions.push({
                        date: new Date().toISOString(),
                        image: imageInfo,
                        model: modelInfo,
                        downloadCount: 0
                    });
                    user.lastActivity = new Date().toISOString();
                    this.saveUsers();
                }
            }

            getPlanLimit(plan) {
                const limits = {
                    'free': 1,
                    'basic': 10,
                    'pro': 99999
                };
                return limits[plan] || 0;
            }

            saveUsers() {
                localStorage.setItem('tetra3d_business_users', JSON.stringify([...this.users]));
            }

            loadUsers() {
                const saved = localStorage.getItem('tetra3d_business_users');
                if (saved) {
                    this.users = new Map(JSON.parse(saved));
                }
            }

            getAdminStats() {
                let totalUsers = this.users.size;
                let todayConversions = 0;
                let todayRevenue = 0;
                let totalRevenue = 0;

                const today = new Date().toDateString();
                
                this.users.forEach(user => {
                    if (user.plan !== 'free') {
                        const revenue = user.plan === 'basic' ? 50000 : 150000;
                        totalRevenue += revenue;
                        
                        if (new Date(user.joinDate).toDateString() === today) {
                            todayRevenue += revenue;
                        }
                    }

                    user.conversions.forEach(conv => {
                        if (new Date(conv.date).toDateString() === today) {
                            todayConversions++;
                        }
                    });
                });

                return {
                    totalUsers,
                    todayConversions,
                    todayRevenue,
                    totalRevenue
                };
            }
        }

        // Ø§ÛŒØ¬Ø§Ø¯ instance Ø§Ø² Ù…Ø¯ÛŒØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
        const userManager = new TetraUserManager();

        // ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
        function selectPlan(plan) {
            if (plan === 'free') {
                const userId = 'user_' + Date.now();
                userManager.createUser(userId, 'free');
                activateUserPanel(userId);
                alert('ğŸ‰ Ù¾Ù„Ù† Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯! Ø´Ù…Ø§ Û± ØªØ¨Ø¯ÛŒÙ„ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯.');
            } else {
                const planNames = {
                    'basic': 'Ù¾Ø§ÛŒÙ‡ (ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†)',
                    'pro': 'Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ (Û±ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†)'
                };
                
                alert(`ğŸ’³ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù¾Ù„Ù† ${planNames[plan]}:\n\n` +
                      `Û±. Ù…Ø¨Ù„Øº Ø±Ø§ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø²ÛŒØ± ÙˆØ§Ø±ÛŒØ² Ú©Ù†ÛŒØ¯:\n` +
                      `   ğŸ’³ Û¶Û²Û±Û¹-Û¸Û¶Û±Û¸-Û´Û·Û´Û´-Û¹Û±Û±Û²\n\n` +
                      `Û². ØªØµÙˆÛŒØ± Ø±Ø³ÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯\n` +
                      `Û³. Ù¾Ù„Ù† Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯\n\n` +
                      `ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ: @tetrashop_support`);
            }
        }

        function activateUserPanel(userId) {
            const user = userManager.users.get(userId);
            if (!user) return;

            document.getElementById('converter-section').style.display = 'block';
            
            // Ø¢Ù¾Ø¯ÛŒØª Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±
            document.getElementById('current-plan').textContent = 
                user.plan === 'free' ? 'Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ' : user.plan === 'basic' ? 'Ù¾Ø§ÛŒÙ‡' : 'Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ';
            document.getElementById('remaining-conversions').textContent = 
                userManager.getPlanLimit(user.plan) - user.conversionsUsed;
            document.getElementById('used-conversions').textContent = user.conversionsUsed;
            document.getElementById('expiry-date').textContent = 
                new Date(user.expiryDate).toLocaleDateString('fa-IR');
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const userId = userManager.currentUser;
            if (!userManager.canConvert(userId)) {
                alert('âŒ ØªØ¹Ø¯Ø§Ø¯ ØªØ¨Ø¯ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ Ø§ØªÙ…Ø§Ù… Ø±Ø³ÛŒØ¯Ù‡. Ù„Ø·ÙØ§Ù‹ Ù¾Ù„Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±ØªÙ‚Ø§ Ø¯Ù‡ÛŒØ¯.');
                return;
            }

            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§ÛŒÙ„
            const uploadArea = document.getElementById('upload-area');
            uploadArea.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ–¼ï¸</div>
                <h3>${file.name}</h3>
                <p>Ø­Ø¬Ù…: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p style="color: var(--success);">âœ… Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„</p>
            `;

            // Ø´Ø±ÙˆØ¹ ØªØ¨Ø¯ÛŒÙ„
            startConversion(file, userId);
        }

        function startConversion(file, userId) {
            document.getElementById('processing-section').style.display = 'block';

            let progress = 0;
            const steps = ['edge-detection', 'depth-generation', 'mesh-optimization', 'texturing'];
            let currentStep = 0;

            const interval = setInterval(() => {
                progress += 2;
                document.getElementById('conversion-progress').style.width = progress + '%';
                document.getElementById('progress-text').textContent = progress + '%';

                // Ø¢Ù¾Ø¯ÛŒØª Ù…Ø±Ø§Ø­Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´
                if (progress >= 25 * (currentStep + 1) && currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).textContent = 'âœ…';
                    currentStep++;
                }

                if (progress >= 100) {
                    clearInterval(interval);
                    completeConversion(file, userId);
                }
            }, 100);
        }

        function completeConversion(file, userId) {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ù„
            const modelData = {
                vertices: Math.floor(Math.random() * 15000) + 8000,
                faces: Math.floor(Math.random() * 30000) + 16000,
                dimensions: {
                    x: (Math.random() * 10 + 5).toFixed(1),
                    y: (Math.random() * 10 + 5).toFixed(1),
                    z: (Math.random() * 3 + 1).toFixed(1)
                },
                fileSize: (Math.random() * 8 + 2).toFixed(2)
            };

            // Ø«Ø¨Øª ØªØ¨Ø¯ÛŒÙ„
            userManager.recordConversion(userId, {
                name: file.name,
                size: file.size,
                type: file.type
            }, modelData);

            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
            document.getElementById('processing-section').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';

            document.getElementById('vertex-count').textContent = modelData.vertices.toLocaleString('fa-IR');
            document.getElementById('face-count').textContent = modelData.faces.toLocaleString('fa-IR');
            document.getElementById('model-dimensions').textContent = 
                `${modelData.dimensions.x} Ã— ${modelData.dimensions.y} Ã— ${modelData.dimensions.z}`;
            document.getElementById('file-size').textContent = modelData.fileSize + ' MB';

            // Ø¢Ù¾Ø¯ÛŒØª Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±
            activateUserPanel(userId);
        }

        function downloadModel(format) {
            const formats = {
                'glb': 'GLB (Binary)',
                'obj': 'OBJ (Wavefront)',
                'stl': 'STL (Stereolithography)',
                'fbx': 'FBX (Autodesk)'
            };
            
            alert(`ğŸ“¥ Ù…Ø¯Ù„ Ø¨Ø§ ÙØ±Ù…Øª ${formats[format]} Ø¢Ù…Ø§Ø¯Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª!\n\n` +
                  `Ø§ÛŒÙ† ÛŒÚ© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² Ø³ÛŒØ³ØªÙ… ÙˆØ§Ù‚Ø¹ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ø§Ø³Øª.\n` +
                  `Ø¯Ø± Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ØŒ ÙØ§ÛŒÙ„ ÙˆØ§Ù‚Ø¹ÛŒ Ù…Ø¯Ù„ 3D Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`);
        }

        function resetConverter() {
            document.getElementById('result-section').style.display = 'none';
            document.getElementById('upload-area').innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“</div>
                <h3>ØªØµÙˆÛŒØ± Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</h3>
                <p>ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ: JPG, PNG, WebP, BMP</p>
                <p style="color: #ff6b6b; margin-top: 1rem;">Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù…: Û²Û° Ù…Ú¯Ø§Ø¨Ø§ÛŒØª</p>
            `;
            document.getElementById('file-input').value = '';
            
            // Ø±ÛŒØ³Øª progress
            document.getElementById('conversion-progress').style.width = '0%';
            document.getElementById('progress-text').textContent = '0%';
            ['edge-detection', 'depth-generation', 'mesh-optimization', 'texturing'].forEach(id => {
                document.getElementById(id).textContent = 'â³';
            });
        }

        // Drag and Drop
        const uploadArea = document.getElementById('upload-area');
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
        });

        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length) {
                handleFileSelect({ target: { files: files } });
            }
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Tetra 3D Business System Loaded');
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ø§Ø¯Ù…ÛŒÙ† Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø®Ø§ØµÛŒ Ù‡Ø³Øª
            const adminStats = userManager.getAdminStats();
            if (adminStats.totalUsers > 0) {
                document.getElementById('admin-section').style.display = 'block';
                document.getElementById('total-users').textContent = adminStats.totalUsers;
                document.getElementById('today-conversions').textContent = adminStats.todayConversions;
                document.getElementById('today-revenue').textContent = adminStats.todayRevenue.toLocaleString('fa-IR');
                document.getElementById('total-revenue').textContent = adminStats.totalRevenue.toLocaleString('fa-IR');
            }
        });
    </script>
</body>
</html>
